<!DOCTYPE html>
<html>
<head>
    <title>Timeline Positioning Debug Test</title>
    <style>
        body { margin: 0; font-family: Arial; }

        /* Test container */
        #timeline-view {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f0f0f0;
        }

        /* Sticky page header */
        .page-header {
            position: sticky;
            top: 0;
            z-index: 101;
            background: #ffffff;
            border-bottom: 2px solid #0969da;
            padding: 2rem;
        }

        /* Sticky filter bar */
        .sticky-filter-bar {
            position: sticky;
            top: 185px; /* Below page header */
            z-index: 100;
            background: #e0e0e0;
            border-bottom: 2px solid #d73a4a;
            padding: 1rem 2rem;
        }

        /* Content area */
        .page-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 2rem 2rem;
            background: #ffffff;
        }

        /* Timeline items */
        .timeline-item {
            background: #f6f8fa;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="timeline-view">
        <!-- Sticky Page Header -->
        <div class="page-header">
            <h2>Timeline of Events</h2>
            <p>Chronological history with complete source provenance</p>
            <div style="display: flex; gap: 20px; margin-top: 1rem;">
                <div>
                    <div style="font-size: 24px; font-weight: bold;">150</div>
                    <div style="font-size: 12px; color: #666;">Total Events</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: bold;">120</div>
                    <div style="font-size: 12px; color: #666;">Case Events</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: bold;">30</div>
                    <div style="font-size: 12px; color: #666;">Life Events</div>
                </div>
            </div>
        </div>

        <!-- Sticky Filter Bar -->
        <div class="sticky-filter-bar">
            <div style="display: flex; gap: 12px; align-items: center;">
                <button>All Events</button>
                <button>Case</button>
                <button>Life</button>
                <input type="text" placeholder="Search events..." style="padding: 8px; flex: 1;">
            </div>
        </div>

        <!-- Page Content -->
        <div class="page-content" id="pageContent">
            <div id="timelineItems">
                <!-- Timeline items will be generated here -->
            </div>
        </div>
    </div>

    <div class="debug-info" id="debugInfo">
        <div>Page Header Height: <span id="headerHeight">-</span>px</div>
        <div>Filter Bar Height: <span id="filterHeight">-</span>px</div>
        <div>Filter Bar Top: <span id="filterTop">-</span>px</div>
        <div>Page Content Top: <span id="contentTop">-</span>px</div>
        <div>First Item Top: <span id="firstItemTop">-</span>px</div>
        <div>Visible Area Starts: <span id="visibleStart">-</span>px</div>
    </div>

    <script>
        // Generate timeline items
        const container = document.getElementById('timelineItems');
        for (let i = 1; i <= 50; i++) {
            const item = document.createElement('div');
            item.className = 'timeline-item';
            item.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 8px;">Event ${i}</div>
                <div style="color: #666; font-size: 14px;">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                </div>
                <div style="margin-top: 8px; font-size: 12px; color: #0969da;">
                    Source: Document ${i} | Date: 2024-01-${String(i).padStart(2, '0')}
                </div>
            `;
            container.appendChild(item);
        }

        // Measure and display positions
        function updateDebugInfo() {
            const header = document.querySelector('.page-header');
            const filterBar = document.querySelector('.sticky-filter-bar');
            const pageContent = document.querySelector('.page-content');
            const firstItem = document.querySelector('.timeline-item');

            const headerRect = header.getBoundingClientRect();
            const filterRect = filterBar.getBoundingClientRect();
            const contentRect = pageContent.getBoundingClientRect();
            const firstItemRect = firstItem ? firstItem.getBoundingClientRect() : null;

            document.getElementById('headerHeight').textContent = Math.round(headerRect.height);
            document.getElementById('filterHeight').textContent = Math.round(filterRect.height);
            document.getElementById('filterTop').textContent = Math.round(filterRect.top);
            document.getElementById('contentTop').textContent = Math.round(contentRect.top);
            document.getElementById('firstItemTop').textContent = firstItemRect ? Math.round(firstItemRect.top) : '-';

            // Calculate where visible content should start (bottom of filter bar)
            const visibleStart = filterRect.bottom;
            document.getElementById('visibleStart').textContent = Math.round(visibleStart);

            // Highlight if first item is hidden
            if (firstItemRect && firstItemRect.top < visibleStart) {
                document.getElementById('firstItemTop').style.color = '#d73a4a';
                document.getElementById('firstItemTop').style.fontWeight = 'bold';
            } else if (firstItemRect) {
                document.getElementById('firstItemTop').style.color = '#1a7f37';
                document.getElementById('firstItemTop').style.fontWeight = 'bold';
            }
        }

        // Update on load and scroll
        window.addEventListener('load', updateDebugInfo);
        window.addEventListener('scroll', updateDebugInfo);
        window.addEventListener('resize', updateDebugInfo);

        // Update every 100ms to catch dynamic changes
        setInterval(updateDebugInfo, 100);
    </script>
</body>
</html>
