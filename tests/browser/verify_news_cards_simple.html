<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>News Cards Verification</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .pass { color: green; font-weight: bold; }
    .fail { color: red; font-weight: bold; }
    .warn { color: orange; font-weight: bold; }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    #results {
      white-space: pre-wrap;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
    }
    iframe {
      width: 100%;
      height: 800px;
      border: 1px solid #ccc;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>News Article Cards Rendering Verification</h1>

  <div class="section">
    <h2>Test Controls</h2>
    <button onclick="runVerification()">‚ñ∂ Run Verification</button>
    <button onclick="showTargetPage()">üîç Show Target Page</button>
    <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
  </div>

  <div class="section">
    <h2>Verification Results</h2>
    <div id="results"></div>
  </div>

  <div id="iframe-container" style="display: none;">
    <h2>Target Page (for debugging)</h2>
    <iframe id="target-frame" src=""></iframe>
  </div>

  <script>
    let resultsDiv = document.getElementById('results');
    let iframeContainer = document.getElementById('iframe-container');
    let targetFrame = document.getElementById('target-frame');

    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = type === 'pass' ? '‚úÖ' :
                    type === 'fail' ? '‚ùå' :
                    type === 'warn' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
      const className = type === 'pass' ? 'pass' :
                       type === 'fail' ? 'fail' :
                       type === 'warn' ? 'warn' : '';

      const line = document.createElement('div');
      line.className = className;
      line.textContent = `[${timestamp}] ${prefix} ${message}`;
      resultsDiv.appendChild(line);
      console.log(`${prefix} ${message}`);
    }

    function clearResults() {
      resultsDiv.innerHTML = '';
    }

    function showTargetPage() {
      iframeContainer.style.display = 'block';
      targetFrame.src = 'http://localhost:5173/entities/jeffrey_epstein';
      log('Loading target page in iframe for inspection', 'info');
    }

    async function runVerification() {
      clearResults();
      log('Starting verification...', 'info');
      log('Target URL: http://localhost:5173/entities/jeffrey_epstein', 'info');

      try {
        // Create invisible iframe to load and inspect the page
        const testFrame = document.createElement('iframe');
        testFrame.style.display = 'none';
        document.body.appendChild(testFrame);

        log('Loading page in test frame...', 'info');

        // Set up promise to wait for page load
        const loadPromise = new Promise((resolve, reject) => {
          testFrame.onload = resolve;
          testFrame.onerror = reject;
          setTimeout(() => reject(new Error('Timeout')), 15000);
        });

        testFrame.src = 'http://localhost:5173/entities/jeffrey_epstein';

        await loadPromise;

        log('Page loaded, waiting for React to render...', 'info');

        // Wait for React to render
        await new Promise(resolve => setTimeout(resolve, 3000));

        log('Inspecting page content...', 'info');

        // Try to access iframe content (will fail if CORS issue)
        let inspectionResults;
        try {
          const doc = testFrame.contentDocument || testFrame.contentWindow.document;

          // Check for article cards
          const articleCards = doc.querySelectorAll('article, .article-card, [class*="article"]');

          log(`\n=== DOM INSPECTION ===`, 'info');
          log(`Article cards found: ${articleCards.length}`, articleCards.length >= 10 ? 'pass' : articleCards.length > 0 ? 'warn' : 'fail');

          if (articleCards.length > 0) {
            // Inspect first 3 cards
            log('\nInspecting first 3 cards:', 'info');

            for (let i = 0; i < Math.min(3, articleCards.length); i++) {
              const card = articleCards[i];
              const title = card.querySelector('h3, h4, [class*="title"]');
              const publication = card.querySelector('[class*="publication"]');
              const hasContent = card.textContent.length > 50;

              log(`\nCard ${i + 1}:`, 'info');
              log(`  Title: ${title ? title.textContent.substring(0, 80) : 'Not found'}`, title ? 'pass' : 'fail');
              log(`  Publication: ${publication ? publication.textContent : 'Not found'}`, publication ? 'pass' : 'warn');
              log(`  Has content: ${hasContent}`, hasContent ? 'pass' : 'fail');
            }
          }

          // Check for badge
          const badges = doc.querySelectorAll('span, div, [class*="badge"]');
          let badgeFound = false;
          let badgeText = '';

          for (let badge of badges) {
            if (badge.textContent.match(/\d+\s+articles?/i)) {
              badgeFound = true;
              badgeText = badge.textContent;
              break;
            }
          }

          log(`\n=== BADGE VERIFICATION ===`, 'info');
          log(`Badge found: ${badgeText}`, badgeFound ? 'pass' : 'fail');

          // Check page structure
          log(`\n=== PAGE STRUCTURE ===`, 'info');
          const headings = doc.querySelectorAll('h1, h2, h3');
          log(`Headings found: ${headings.length}`, 'info');

          for (let i = 0; i < Math.min(5, headings.length); i++) {
            log(`  ${headings[i].tagName}: ${headings[i].textContent}`, 'info');
          }

          // Summary
          log(`\n=== VERIFICATION SUMMARY ===`, 'info');
          log(`Article cards in DOM: ${articleCards.length >= 10 ? 'PASS' : 'FAIL'} (${articleCards.length} found)`,
              articleCards.length >= 10 ? 'pass' : 'fail');
          log(`Cards have content: ${articleCards.length > 0 && articleCards[0].textContent.length > 50 ? 'PASS' : 'FAIL'}`,
              articleCards.length > 0 ? 'pass' : 'fail');
          log(`Badge displays: ${badgeFound ? 'PASS' : 'FAIL'}`,
              badgeFound ? 'pass' : 'fail');

          log('\n‚úÖ Verification complete!', 'pass');

        } catch (e) {
          log(`\n‚ùå Cannot inspect iframe content (CORS restriction)`, 'fail');
          log(`Error: ${e.message}`, 'fail');
          log(`\nAlternative: Open browser console and run:`, 'warn');
          log(`  document.querySelectorAll('article').length`, 'info');
          log(`  document.querySelectorAll('[class*="article"]').length`, 'info');

          // Show the page for manual inspection
          showTargetPage();
        }

        // Clean up
        document.body.removeChild(testFrame);

      } catch (error) {
        log(`Error during verification: ${error.message}`, 'fail');
        log('Please ensure the frontend is running on http://localhost:5173', 'warn');
      }
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      log('Verification tool loaded. Click "Run Verification" to begin.', 'info');
    });
  </script>
</body>
</html>
